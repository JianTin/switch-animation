"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _newArrowCheck=require("@babel/runtime/helpers/newArrowCheck"),BezierEasing=require("bezier-easing"),colorString=require("color-string"),_assertThisInitialized=require("@babel/runtime/helpers/assertThisInitialized"),_inheritsLoose=require("@babel/runtime/helpers/inheritsLoose");function _interopDefaultLegacy(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var _newArrowCheck__default=_interopDefaultLegacy(_newArrowCheck),BezierEasing__default=_interopDefaultLegacy(BezierEasing),colorString__default=_interopDefaultLegacy(colorString),_assertThisInitialized__default=_interopDefaultLegacy(_assertThisInitialized),_inheritsLoose__default=_interopDefaultLegacy(_inheritsLoose),constantEasing={linear:[1,1,0,0],easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]},colorArry=["color","background-color","border-color"],shadow="box-shadow",transformArray=["rotate","rotateX","rotateY","rotateZ","translateX","translateY","translateZ","scaleX","scaleY","scaleZ","skewX","skewY"],Easing=function(){var e=this;this.createEasing=function(t){if(_newArrowCheck__default.default(this,e),Array.isArray(t))return BezierEasing__default.default.apply(void 0,t);t=(t=this.bulitInEasing[t])||this.bulitInEasing.linear;return BezierEasing__default.default.apply(void 0,t)}.bind(this),this.bulitInEasing=constantEasing},easing=new Easing,Store=function(){function t(){var r=this;this.createType=function(t){_newArrowCheck__default.default(this,r),this.store[t]||(this.store[t]={styleList:{},instance:null,durationObj:null,easingFn:null})}.bind(this),this.initGlobalStore=function(t){_newArrowCheck__default.default(this,r),this.globalStore=t}.bind(this),this.addStoreStyle=function(t,e,n,i,a){_newArrowCheck__default.default(this,r),this.createType(t),"box-shadow"===e?this.generateBoxShadow(t,e,n,i,a):this.colorNameArray.includes(e)?this.generateColorStyle(t,e,n,i,a):this.generateBaseStyle(t,e,n,i,a)}.bind(this),this.addStoreInstance=function(t,e){_newArrowCheck__default.default(this,r),this.createType(t),this.store[t].instance=e}.bind(this),this.addStoreDirection=function(t,e,n){_newArrowCheck__default.default(this,r),this.createType(t);var i=this.globalStore;i&&(i=i.duration,this.store[t].durationObj={positive:{startDuration:e,endDuration:n},negative:{startDuration:i-n,endDuration:i-e},direction:null,isStart:!1})}.bind(this),this.addStoreEasing=function(t,e){_newArrowCheck__default.default(this,r),this.store[t].easingFn=easing.createEasing(e)}.bind(this),this.globalStore=null,this.store={},this.colorNameArray=colorArry}var e=t.prototype;return e.generateBaseStyle=function(t,e,n,i,a){var r=this,s=Object.values(n).map(function(t){return _newArrowCheck__default.default(this,r),Number(t)}.bind(this)),n=s[0],s=s[1];this.store[t].styleList[e]={startValue:n,endValue:s,millisecond:(s-n)/a,unit:i,distance:n<s?s-n:n-s,minValDistanceZero:n<s?n:s}},e.handelArrayToStyleStore=function(t,i){var a=this,e=t.startValue,r=t.endValue,n=e.reduce(function(t,e,n){_newArrowCheck__default.default(this,a);n=r[n];return t.distance.push(e<n?n-e:e-n),t.minValDistanceZero.push(e<n?e:n),t.millisecond.push((n-e)/i),t}.bind(this),{millisecond:[],distance:[],minValDistanceZero:[]}),s=n.millisecond,t=n.distance,n=n.minValDistanceZero;return{startValue:e,endValue:r,distance:t,millisecond:s,minValDistanceZero:n}},e.handelColorParams=function(n){var i=this;return Object.keys(n).reduce(function(t,e){return _newArrowCheck__default.default(this,i),t[e]=colorString__default.default.get(n[e]).value,t}.bind(this),{startValue:[],endValue:[]})},e.generateColorStyle=function(t,e,n,i,a){var r=this.handelArrayToStyleStore(this.handelColorParams(n),a),s=r.startValue,o=r.endValue,n=r.millisecond,a=r.distance,r=r.minValDistanceZero;4===s.length&&4===o.length&&4===n.length&&this.store[t]&&(this.store[t].styleList[e]={startValue:s,endValue:o,millisecond:n,distance:a,minValDistanceZero:r,unit:i})},e.generateBoxShadow=function(t,e,n,i,d){var c=this,a=n.startValue,r=n.endValue,n=new RegExp(i,"g"),a=a.replace(n,"").split(/,(?![^\(]*\))/),s=r.replace(n,"").split(/,(?![^\(]*\))/),r=a.reduce(function(t,e,n){_newArrowCheck__default.default(this,c);var i=e.split(/ (?![^\(]*\))/).filter(Boolean),a=s[n].split(/ (?![^\(]*\))/).filter(Boolean);i&&6===i.length&&(t.inset.push(n),i.shift(),a.shift());e=i.pop(),n=a.pop();return t.color.push(this.handelColorParams({startValue:e,endValue:n})),t.shadowNumber.push({startValue:i.map(Number),endValue:a.map(Number)}),t}.bind(this),{color:[],inset:[],shadowNumber:[]}),n=r.color,a=r.inset,f=r.shadowNumber,n=n.reduce(function(t,e,n){_newArrowCheck__default.default(this,c);var i=f[n],a=this.handelArrayToStyleStore(e,d),r=a.startValue,s=a.endValue,o=a.millisecond,l=a.distance,u=a.minValDistanceZero,h=this.handelArrayToStyleStore(i,d),n=h.startValue,e=h.endValue,a=h.millisecond,i=h.distance,h=h.minValDistanceZero;return t.startValue.push({color:r,shadowNumber:n}),t.endValue.push({color:s,shadowNumber:e}),t.millisecond.push({color:o,shadowNumber:a}),t.distance.push({color:l,shadowNumber:i}),t.minValDistanceZero.push({color:u,shadowNumber:h}),t}.bind(this),{startValue:[],endValue:[],millisecond:[],distance:[],minValDistanceZero:[]});this.store[t].styleList[e]=Object.assign(n,{unit:i,inset:a})},t}(),Calculate=function(){function t(){}var e=t.prototype;return e.calculateVal=function(t,e,n,i,a){return"box-shadow"===e?this.shadowCalulate(t,n,i,a):colorArry.includes(e)?this.colorCalculate(t,n,i,a):this.baseStyleCalulate(t,n,i,a)},e.baseStyleCalulate=function(t,e,n,i){var a=t.startValue,r=t.endValue,s=t.millisecond,o=t.distance,l=t.minValDistanceZero,t=t.unit,s=s*e,e=0,e=n?a+s:r-s;return 0===o?e+t:i((e-l)/o)*o+l+t},e.colorCalculate=function(t,e,n,s){var o=this,i=t.startValue,a=t.endValue,r=t.millisecond,l=t.distance,u=t.minValDistanceZero,h=r.map(function(t){return _newArrowCheck__default.default(this,o),t*e}.bind(this));return n?i.reduce(function(t,e,n){_newArrowCheck__default.default(this,o);var i=h[n],a=l[n],r=u[n],i=e+i;return t+=0===a?i:a*s((i-r)/a)+r,3!==n&&(t+=","),3===n&&(t+=")"),t}.bind(this),"rgba("):a.reduce(function(t,e,n){_newArrowCheck__default.default(this,o);var i=h[n],a=l[n],r=u[n],i=e-i;return t+=0===a?i:a*s((i-r)/a)+r,3!==n&&(t+=","),3===n&&(t+=")"),t}.bind(this),"rgba(")},e.shadowCalulate=function(t,f,_,m){var w=this,e=t.startValue,b=t.endValue,A=t.millisecond,S=t.distance,y=t.minValDistanceZero,g=t.unit,v=t.inset;return e.reduce(function(t,e,n){var i=this;_newArrowCheck__default.default(this,w),0!==n&&(t+=","),v.includes(n)&&(t+="inset");var a=e.color,r=e.shadowNumber,s=b[n],o=s.color,l=s.shadowNumber,u=A[n],e=u.color,h=u.shadowNumber,s=S[n],u=s.color,d=s.shadowNumber,s=y[n],n=s.color,c=s.shadowNumber,n=this.colorCalculate({startValue:a,endValue:o,millisecond:e,distance:u,minValDistanceZero:n,unit:""},f,_,m);return t+=r.reduce(function(t,e,n){return _newArrowCheck__default.default(this,i),t+=" "+this.baseStyleCalulate({startValue:e,endValue:l[n],millisecond:h[n],distance:d[n],minValDistanceZero:c[n],unit:g},f,_,m)}.bind(this),"")+" "+n}.bind(this),"")},t}(),calculateInstance=new Calculate,SetStyleValue=function(){function t(){var r=this;this.setTransform=function(t,e,n,i){_newArrowCheck__default.default(this,r);var a=t.style.transform;a.includes(e)&&(a=a.replace(new RegExp(e+"\\(-*[0-9]*\\.*[0-9]*"+i+"\\)","g"),"")),t.style.transform=a+=" "+e+"("+n+")"}.bind(this),this.setBaseStyle=function(t,e,n,i){_newArrowCheck__default.default(this,r),t.style[e]=n}.bind(this),this.transformKey=transformArray}return t.prototype.set=function(t,e,n,i,a,r){var s=e.unit,r=calculateInstance.calculateVal(e,n,i,a,r);this.transformKey.includes(n)?this.setTransform(t,n,r,s):this.setBaseStyle(t,n,r,s)},t}(),SetStyleValueInstance=new SetStyleValue,IsRunMiddleAnimation=function(){function t(){var l=this;this.runMiddleAnimation=function(t,e,n,i){_newArrowCheck__default.default(this,l);var a,r=i.store[e],s=r.instance,o=r.durationObj;s&&o&&(a=o.positive,i=o.negative,e=o.direction,r=o.isStart,n===e&&!r||(i=(a=n?a:i).startDuration,a=a.endDuration,i<t&&t<a&&(o.direction=n,r?(o.isStart=!1,s.startAnimation()):s.switchAnimation())))}.bind(this)}var e=t.prototype;return e.getDurationType=function(t){var e=this;return t.split("-").map(function(t){return _newArrowCheck__default.default(this,e),Number(t)}.bind(this))},e.middleAnimationInit=function(u,h){var d=this;Object.keys(u).forEach(function(t){_newArrowCheck__default.default(this,d);var e=this.getDurationType(t),n=e[0],i=e[1],a=u[t],r=a.onStart,s=a.onEnd,o=a.onAnimation,l=a.easing;delete a.onStart,delete a.onEnd,delete a.onAnimation,delete a.easing,new Animation({duration:i-n,element:null===(e=h.globalStore)||void 0===e?void 0:e.element,targetStyle:a,durationType:t,easing:l||(null===(l=h.globalStore)||void 0===l?void 0:l.easing),onStart:r,onEnd:s,onAnimation:o},h),h.addStoreDirection(t,n,i)}.bind(this))},t}(),isRunMiddleInstance=new IsRunMiddleAnimation,Public=function(t,e){var h=this;this.initEvent=function(t){var a=this;_newArrowCheck__default.default(this,h);var r=this.durationType,e=this.easing,s=this.storeInstance,o=t.targetStyle,n=t.middleStyle,l=t.duration;if("all"===r&&s.initGlobalStore(this),!o)return isRunMiddleInstance.middleAnimationInit(n,s);Object.keys(o).forEach(function(t){_newArrowCheck__default.default(this,a);var e,n,i=o[t];i&&(e=i.endValue,n=i.startValue,i=i.unit,s.addStoreStyle(r,t,{startValue:n,endValue:e},i,l))}.bind(this)),s.addStoreInstance(r,this),s.addStoreEasing(r,e)}.bind(this),this.endInit=function(){_newArrowCheck__default.default(this,h);var t=this.AnimationCallback.onEnd;t&&t(this.element)}.bind(this),this.reset=function(n){var i=this;_newArrowCheck__default.default(this,h);var a,r,t=this.targetStyle,e=this.durationType,s=this.duration,o=this.element,l=this.storeInstance,u=this.AnimationCallback.onAnimation;t&&(e=l.store[e],a=e.easingFn,r=e.styleList,a&&Object.keys(r).forEach(function(t){_newArrowCheck__default.default(this,i);var e=r[t];e&&(SetStyleValueInstance.set(o,e,t,s,n,a),u&&u(o))}.bind(this)))}.bind(this);var n=t.element,i=t.targetStyle,a=t.onStart,r=t.onAnimation,s=t.onEnd,o=t.duration,l=t.durationType,u=t.easing,u=void 0===u?"linear":u;this.currentDate=0,this.startDate=0,this.endDate=0,this.element=n,this.duration=o,this.targetStyle=i||null,this.AnimationCallback={onStart:a,onAnimation:r,onEnd:s},this.durationType=l,this.isInit=!0,this.isPositive=!0,this.animationShow=!1,this.easing=u,this.storeInstance=e,this.initEvent(t)},Animation=function(n){function t(t,e){var i=this,m=n.call(this,t,e)||this;return m.startAnimation=function(){var e=this;_newArrowCheck__default.default(this,i);var t=_assertThisInitialized__default.default(m).storeInstance;m.isInit=!1,m.isPositive=!0;var n=(new Date).valueOf();m.endDate=n+m.duration,m.startDate=n,m.animationShow=!0,m.targetStyle||Object.values(t.store).forEach(function(t){return _newArrowCheck__default.default(this,e),t.durationObj.isStart=!0}.bind(this)),m.runSwitchAnimation(!0)}.bind(this),m.switchAnimation=function(){_newArrowCheck__default.default(this,i);var t=m.AnimationCallback.onStart;m.isInit?m.startAnimation():(m.animationShow=m.isPositive=!m.isPositive,m.endDate=(new Date).valueOf()+(m.currentDate-m.startDate),m.startDate=m.endDate-m.duration),m.runSwitchAnimation(m.isPositive),t&&t(m.element)}.bind(this),m.runSwitchAnimation=function(f){var _=this;_newArrowCheck__default.default(this,i),requestAnimationFrame(function(){var n=this;_newArrowCheck__default.default(this,_);var t=_assertThisInitialized__default.default(m),e=t.startDate,i=t.endDate,a=t.element,r=t.targetStyle,s=t.isPositive,o=t.durationType,l=t.storeInstance,u=m.AnimationCallback.onAnimation,t=(new Date).valueOf();if(m.currentDate=t,f===s){if(i<=t)return m.reset(!!f),m.currentDate=i,void m.endInit();var h,d,c=t-e;r?(o=l.store[o],h=o.styleList,d=o.easingFn,Object.keys(h).forEach(function(t){_newArrowCheck__default.default(this,n);var e=h[t];e&&d&&SetStyleValueInstance.set(a,e,t,c,s,d)}.bind(this)),u&&u(a)):Object.keys(l.store).forEach(function(t){return _newArrowCheck__default.default(this,n),isRunMiddleInstance.runMiddleAnimation(c,t,f,l)}.bind(this)),m.runSwitchAnimation(f)}}.bind(this))}.bind(this),m}return _inheritsLoose__default.default(t,n),t}(Public),SwitchAnimation=function(t){var a=this;this.getInstanceEvent=function(){var t=this;_newArrowCheck__default.default(this,a);var e=this.animationInstance,n=e.startAnimation,e=e.switchAnimation,i=this;return{isAnimationShow:function(){return _newArrowCheck__default.default(this,t),i.animationInstance.animationShow}.bind(this),startAnimation:n,switchAnimation:e}}.bind(this),this.storeInstance=new Store,this.animationInstance=new Animation(t,this.storeInstance)},generateStyleValue=function(){var l=this;this.generateStyle=function(t,e,n,i){_newArrowCheck__default.default(this,l);var a=this.baseStyle,r=this.colorStyle,s=this.shadowStyle;return(colorArry.includes(t)?r:t===shadow?s:a)(e,n,i)}.bind(this),this.baseStyle=function(t,e,n){_newArrowCheck__default.default(this,l);var i=t.startValue,a=t.endValue,t=t.unit;return(Number(a)-Number(i))/e*n+Number(i)+t}.bind(this),this.colorStyle=function(t,i,a){var r=this;_newArrowCheck__default.default(this,l);var s=this.baseStyle,e=t.startValue,t=t.endValue,e=colorString__default.default.get(e).value,o=colorString__default.default.get(t).value;return e.reduce(function(t,e,n){return _newArrowCheck__default.default(this,r),t+=s({startValue:e,endValue:o[n],unit:""},i,a),3!==n&&(t+=","),3===n&&(t+=")"),t}.bind(this),"rgba(")}.bind(this),this.shadowStyle=function(t,e,n){return _newArrowCheck__default.default(this,l),""}.bind(this)},generateStyle=(new generateStyleValue).generateStyle,ValueMappingStyle=function(){function t(t){var d=this;this.setStyleList=function(i){var a=this;_newArrowCheck__default.default(this,d);var r=this.element;Object.keys(i).forEach(function(t){_newArrowCheck__default.default(this,a);var e,n=i[t];n&&(e=n.value,n=n.unit,transformArray.includes(t)?SetStyleValueInstance.setTransform(r,t,e,n):SetStyleValueInstance.setBaseStyle(r,t,e,n))}.bind(this))}.bind(this),this.runAnimation=function(a,r,s,o){var l=this;_newArrowCheck__default.default(this,d),requestAnimationFrame(function(){if(_newArrowCheck__default.default(this,l),this.currentAnimationId===o){var t=this.startDuration,e=this.setStyleList,n=this.runAnimation,i=(new Date).valueOf()-t;if(s<=i){t=r[Number(r.length)-1];return this.oldSelect=t,e(a[t])}i=i/s*Number(r.length),i=r[Math.round(i)];this.oldSelect=i,e(a[i]),n(a,r,s,o)}}.bind(this))}.bind(this),this.getAnimationRangeStyleList=function(t,e,n,i){var a=this;_newArrowCheck__default.default(this,d);var r=Object.assign({},t);return Object.keys(r).map(Number).forEach(function(t){_newArrowCheck__default.default(this,a),i?e<t&&t<n||delete r[String(t)]:n<t&&t<e||delete r[String(t)]}.bind(this)),r}.bind(this),this.valueAnimation=function(e,t){var n=this;_newArrowCheck__default.default(this,d);var i,a,r,s=this.oldSelect,o=this.mappingStyleList,l=this.setStyleList,u=this.getAnimationRangeStyleList,h=this.runAnimation;this.oldSelect=e,null!=s&&t?(a=u(o,s,e,i=s<e),u=Object.keys(a).map(Number).sort(function(t,e){return _newArrowCheck__default.default(this,n),t-e}.bind(this)),s=(new Date).valueOf(),this.currentAnimationId=s,this.startDuration=s,this.endDuration=s+t,h(a,i?u:u.reverse(),t,s)):(r="",Object.keys(o).forEach(function(t){_newArrowCheck__default.default(this,n),e>=Number(t)&&(r=t)}.bind(this)),l(o[r]))}.bind(this);var e=t.element,n=t.initValue,t=t.rangeConfig;this.element=e,this.mappingStyleList={},this.oldSelect=null,this.startDuration=0,this.endDuration=0,this.currentAnimationId=null,this.init(t,n)}return t.prototype.init=function(l,t){var u=this,e=this.valueAnimation;Object.keys(l).forEach(function(t){_newArrowCheck__default.default(this,u);for(var n=this.mappingStyleList,e=t.split("-").map(Number),i=e[0],a=e[1],s=a-i,o=l[t],r=i;r<=a;r+=.1)!function(a){var r=this,t=Object.keys(o).reduce(function(t,e){_newArrowCheck__default.default(this,r);var n=o[e];if(!n)return t;var i=generateStyle(e,n,s,a);return console.log(i),t[e]={value:i,unit:n.unit},t}.bind(this),{}),e=String(a);n.hasOwnProperty(e)?n[e]=Object.assign(n[e],t):n[e]=t}(r)}.bind(this)),e(Number(t))},t}();function wholeAnimation(t){t=Object.assign(t,{durationType:"all",targetStyle:t.animation});return delete t.animation,new SwitchAnimation(t).getInstanceEvent()}function segmentedAnimation(t){t=Object.assign(t,{durationType:"all",middleStyle:t.animation});return delete t.animation,new SwitchAnimation(t).getInstanceEvent()}function valueMappingAnimation(t){return new ValueMappingStyle(t).valueAnimation}exports.segmentedAnimation=segmentedAnimation,exports.valueMappingAnimation=valueMappingAnimation,exports.wholeAnimation=wholeAnimation;
