import _assertThisInitialized from"@babel/runtime/helpers/assertThisInitialized";import _inheritsLoose from"@babel/runtime/helpers/inheritsLoose";import _newArrowCheck from"@babel/runtime/helpers/newArrowCheck";import BezierEasing from"bezier-easing";import colorString from"color-string";var Easing=function(){var e=this;this.createEasing=function(t){if(_newArrowCheck(this,e),Array.isArray(t))return BezierEasing.apply(void 0,t);t=(t=this.bulitInEasing[t])||this.bulitInEasing.linear;return BezierEasing.apply(void 0,t)}.bind(this),this.bulitInEasing={linear:[1,1,0,0],easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]}},easing=new Easing,Store=function(){function t(){var s=this;this.createType=function(t){_newArrowCheck(this,s),this.store[t]||(this.store[t]={styleList:{},instance:null,durationObj:null,easingFn:null})}.bind(this),this.initGlobalStore=function(t){_newArrowCheck(this,s),this.globalStore=t}.bind(this),this.addStoreStyle=function(t,e,n,i,a){_newArrowCheck(this,s),this.createType(t),"box-shadow"===e?this.generateBoxShadow(t,e,n,i,a):this.colorNameArray.includes(e)?this.generateColorStyle(t,e,n,i,a):this.generateBaseStyle(t,e,n,i,a),console.log(this.store)}.bind(this),this.addStoreInstance=function(t,e){_newArrowCheck(this,s),this.createType(t),this.store[t].instance=e}.bind(this),this.addStoreDirection=function(t,e,n){_newArrowCheck(this,s),this.createType(t);var i=this.globalStore;i&&(i=i.duration,this.store[t].durationObj={positive:{startDuration:e,endDuration:n},negative:{startDuration:i-n,endDuration:i-e},direction:null,isStart:!1})}.bind(this),this.addStoreEasing=function(t,e){_newArrowCheck(this,s),this.store[t].easingFn=easing.createEasing(e)}.bind(this),this.globalStore=null,this.store={},this.colorNameArray=["color","background-color","border-color"]}var e=t.prototype;return e.generateBaseStyle=function(t,e,n,i,a){var s=this,r=Object.values(n).map(function(t){return _newArrowCheck(this,s),Number(t)}.bind(this)),n=r[0],r=r[1];this.store[t].styleList[e]={startValue:n,endValue:r,millisecond:(r-n)/a,unit:i,distance:n<r?r-n:n-r,minValDistanceZero:n<r?n:r}},e.handelArrayToStyleStore=function(t,i){var a=this,e=t.startValue,s=t.endValue,n=e.reduce(function(t,e,n){_newArrowCheck(this,a);n=s[n];return t.distance.push(e<n?n-e:e-n),t.minValDistanceZero.push(e<n?e:n),t.millisecond.push((n-e)/i),t}.bind(this),{millisecond:[],distance:[],minValDistanceZero:[]}),r=n.millisecond,t=n.distance,n=n.minValDistanceZero;return{startValue:e,endValue:s,distance:t,millisecond:r,minValDistanceZero:n}},e.handelColorParams=function(n){var i=this;return Object.keys(n).reduce(function(t,e){return _newArrowCheck(this,i),t[e]=colorString.get(n[e]).value,t}.bind(this),{startValue:[],endValue:[]})},e.generateColorStyle=function(t,e,n,i,a){var s=this.handelArrayToStyleStore(this.handelColorParams(n),a),r=s.startValue,o=s.endValue,n=s.millisecond,a=s.distance,s=s.minValDistanceZero;4===r.length&&4===o.length&&4===n.length&&this.store[t]&&(this.store[t].styleList[e]={startValue:r,endValue:o,millisecond:n,distance:a,minValDistanceZero:s,unit:i})},e.generateBoxShadow=function(t,e,n,i,h){var d=this,a=n.startValue,s=n.endValue,n=new RegExp(i,"g"),a=a.replace(n,"").split(/,(?![^\(]*\))/),r=s.replace(n,"").split(/,(?![^\(]*\))/),s=a.reduce(function(t,e,n){_newArrowCheck(this,d);var i=e.split(/ (?![^\(]*\))/).filter(Boolean),a=r[n].split(/ (?![^\(]*\))/).filter(Boolean);i&&6===i.length&&(t.inset.push(n),i.shift(),a.shift());e=i.pop(),n=a.pop();return t.color.push(this.handelColorParams({startValue:e,endValue:n})),t.shadowNumber.push({startValue:i.map(Number),endValue:a.map(Number)}),t}.bind(this),{color:[],inset:[],shadowNumber:[]}),n=s.color,a=s.inset,m=s.shadowNumber,n=n.reduce(function(t,e,n){_newArrowCheck(this,d);var i=m[n],a=this.handelArrayToStyleStore(e,h),s=a.startValue,r=a.endValue,o=a.millisecond,l=a.distance,c=a.minValDistanceZero,u=this.handelArrayToStyleStore(i,h),n=u.startValue,e=u.endValue,a=u.millisecond,i=u.distance,u=u.minValDistanceZero;return t.startValue.push({color:s,shadowNumber:n}),t.endValue.push({color:r,shadowNumber:e}),t.millisecond.push({color:o,shadowNumber:a}),t.distance.push({color:l,shadowNumber:i}),t.minValDistanceZero.push({color:c,shadowNumber:u}),t}.bind(this),{startValue:[],endValue:[],millisecond:[],distance:[],minValDistanceZero:[]});this.store[t].styleList[e]=Object.assign(n,{unit:i,inset:a})},t}(),storeInstance=new Store,Calculate=function(){function t(){}var e=t.prototype;return e.calculateVal=function(t,e,n,i,a){return"box-shadow"===e?this.shadowCalulate(t,n,i,a):storeInstance.colorNameArray.includes(e)?this.colorCalculate(t,n,i,a):this.baseStyleCalulate(t,n,i,a)},e.baseStyleCalulate=function(t,e,n,i){var a=t.startValue,s=t.endValue,r=t.millisecond,o=t.distance,l=t.minValDistanceZero,t=t.unit,r=r*e,e=0,e=n?a+r:s-r;return 0===o?e+t:i((e-l)/o)*o+l+t},e.colorCalculate=function(t,e,n,r){var o=this,i=t.startValue,a=t.endValue,s=t.millisecond,l=t.distance,c=t.minValDistanceZero,u=s.map(function(t){return _newArrowCheck(this,o),t*e}.bind(this));return n?i.reduce(function(t,e,n){_newArrowCheck(this,o);var i=u[n],a=l[n],s=c[n],i=e+i;return t+=0===a?i:a*r((i-s)/a)+s,3!==n&&(t+=","),3===n&&(t+=")"),t}.bind(this),"rgba("):a.reduce(function(t,e,n){_newArrowCheck(this,o);var i=u[n],a=l[n],s=c[n],i=e-i;return t+=0===a?i:a*r((i-s)/a)+s,3!==n&&(t+=","),3===n&&(t+=")"),t}.bind(this),"rgba(")},e.shadowCalulate=function(t,m,w,b){var f=this,e=t.startValue,S=t.endValue,v=t.millisecond,A=t.distance,y=t.minValDistanceZero,g=t.unit,p=t.inset;return e.reduce(function(t,e,n){var i=this;_newArrowCheck(this,f),0!==n&&(t+=","),p.includes(n)&&(t+="inset");var a=e.color,s=e.shadowNumber,r=S[n],o=r.color,l=r.shadowNumber,c=v[n],e=c.color,u=c.shadowNumber,r=A[n],c=r.color,h=r.shadowNumber,r=y[n],n=r.color,d=r.shadowNumber,n=this.colorCalculate({startValue:a,endValue:o,millisecond:e,distance:c,minValDistanceZero:n,unit:""},m,w,b);return t+=s.reduce(function(t,e,n){return _newArrowCheck(this,i),t+=" "+this.baseStyleCalulate({startValue:e,endValue:l[n],millisecond:u[n],distance:h[n],minValDistanceZero:d[n],unit:g},m,w,b)}.bind(this),"")+" "+n}.bind(this),"")},t}(),calculateInstance=new Calculate,SetStyleValue=function(){function t(){var s=this;this.setTransform=function(t,e,n,i){_newArrowCheck(this,s);var a=t.style.transform;a.includes(e)&&(a=a.replace(new RegExp(e+"\\(-*[0-9]*\\.*[0-9]*"+i+"\\)","g"),"")),t.style.transform=a+=" "+e+"("+n+")"}.bind(this),this.setBaseStyle=function(t,e,n,i){_newArrowCheck(this,s),t.style[e]=n}.bind(this),this.transformKey=["rotate","rotateX","rotateY","rotateZ","translateX","translateY","translateZ","scaleX","scaleY","scaleZ","skewX","skewY"]}return t.prototype.set=function(t,e,n,i,a,s){var r=e.unit,s=calculateInstance.calculateVal(e,n,i,a,s);this.transformKey.includes(n)?this.setTransform(t,n,s,r):this.setBaseStyle(t,n,s,r)},t}(),setStyleInstance=new SetStyleValue,IsRunMiddleAnimation=function(){function t(){var l=this;this.runMiddleAnimation=function(t,e,n){_newArrowCheck(this,l);var i,a,s=storeInstance.store[e],r=s.instance,o=s.durationObj;r&&o&&(a=o.positive,i=o.negative,e=o.direction,s=o.isStart,n===e&&!s||(i=(a=n?a:i).startDuration,a=a.endDuration,i<t&&t<a&&(o.direction=n,s?(o.isStart=!1,r.getInstanceEvent().startAnimation()):r.getInstanceEvent().switchAnimation())))}.bind(this)}var e=t.prototype;return e.getDurationType=function(t){var e=this;return t.split("-").map(function(t){return _newArrowCheck(this,e),Number(t)}.bind(this))},e.middleAnimationInit=function(c){var u=this;Object.keys(c).forEach(function(t){_newArrowCheck(this,u);var e=this.getDurationType(t),n=e[0],i=e[1],a=c[t],s=a.onStart,r=a.onEnd,o=a.onAnimation,l=a.easing;delete a.onStart,delete a.onEnd,delete a.onAnimation,delete a.easing,new SwitchAnimation({duration:i-n,element:null===(e=storeInstance.globalStore)||void 0===e?void 0:e.element,targetStyle:a,durationType:t,easing:l||(null===(l=storeInstance.globalStore)||void 0===l?void 0:l.easing),onStart:s,onEnd:r,onAnimation:o}),storeInstance.addStoreDirection(t,n,i)}.bind(this))},t}(),isRunMiddleInstance=new IsRunMiddleAnimation,Public=function(t){var c=this;this.initEvent=function(t){var a=this;_newArrowCheck(this,c);var s=this.durationType,e=this.easing,r=t.targetStyle,n=t.middleStyle,o=t.duration;if("all"===s&&storeInstance.initGlobalStore(this),!r)return isRunMiddleInstance.middleAnimationInit(n);Object.keys(r).forEach(function(t){_newArrowCheck(this,a);var e,n,i=r[t];i&&(e=i.endValue,n=i.startValue,i=i.unit,storeInstance.addStoreStyle(s,t,{startValue:n,endValue:e},i,o))}.bind(this)),storeInstance.addStoreInstance(s,this),storeInstance.addStoreEasing(s,e)}.bind(this),this.endInit=function(){_newArrowCheck(this,c);var t=this.AnimationCallback.onEnd;t&&t(this.element)}.bind(this),this.reset=function(n){var i=this;_newArrowCheck(this,c);var a,s,t=this.targetStyle,e=this.durationType,r=this.duration,o=this.element,l=this.AnimationCallback.onAnimation;t&&(e=storeInstance.store[e],a=e.easingFn,s=e.styleList,a&&Object.keys(s).forEach(function(t){_newArrowCheck(this,i);var e=s[t];e&&(setStyleInstance.set(o,e,t,r,n,a),l&&l(o))}.bind(this)))}.bind(this);var e=t.element,n=t.targetStyle,i=t.onStart,a=t.onAnimation,s=t.onEnd,r=t.duration,o=t.durationType,l=void 0===o?"all":o,o=t.easing,o=void 0===o?"linear":o;this.currentDate=0,this.startDate=0,this.endDate=0,this.element=e,this.duration=r,this.targetStyle=n||null,this.AnimationCallback={onStart:i,onAnimation:a,onEnd:s},this.durationType=l,this.isInit=!0,this.isPositive=!0,this.animationShow=!1,this.easing=o,this.initEvent(t)},Switch=function(e){function t(t){var n=this,w=e.call(this,t)||this;return w.start=function(){var e=this;_newArrowCheck(this,n),w.isInit=!1,w.isPositive=!0;var t=(new Date).valueOf();w.endDate=t+w.duration,w.startDate=t,w.animationShow=!0,w.targetStyle||Object.values(storeInstance.store).forEach(function(t){return _newArrowCheck(this,e),t.durationObj.isStart=!0}.bind(this)),w.runSwitchAnimation(!0)}.bind(this),w.switch=function(){_newArrowCheck(this,n);var t=w.AnimationCallback.onStart;w.isInit?w.start():(w.animationShow=w.isPositive=!w.isPositive,w.endDate=(new Date).valueOf()+(w.currentDate-w.startDate),w.startDate=w.endDate-w.duration),w.runSwitchAnimation(w.isPositive),t&&t(w.element)}.bind(this),w.runSwitchAnimation=function(d){var m=this;_newArrowCheck(this,n),requestAnimationFrame(function(){var n=this;_newArrowCheck(this,m);var t=_assertThisInitialized(w),e=t.startDate,i=t.endDate,a=t.element,s=t.targetStyle,r=t.isPositive,o=t.durationType,l=w.AnimationCallback.onAnimation,t=(new Date).valueOf();if(w.currentDate=t,d===r){if(i<=t)return w.reset(!!d),w.currentDate=i,void w.endInit();var c,u,h=t-e;s?(o=storeInstance.store[o],c=o.styleList,u=o.easingFn,Object.keys(c).forEach(function(t){_newArrowCheck(this,n);var e=c[t];e&&u&&setStyleInstance.set(a,e,t,h,r,u)}.bind(this)),l&&l(a)):Object.keys(storeInstance.store).forEach(function(t){return _newArrowCheck(this,n),isRunMiddleInstance.runMiddleAnimation(h,t,d)}.bind(this)),w.runSwitchAnimation(d)}}.bind(this))}.bind(this),w}return _inheritsLoose(t,e),t}(Public),SwitchAnimation=function(i){function t(t){var e=this,n=i.call(this,t)||this;return n.getInstanceEvent=function(){var t=this;return _newArrowCheck(this,e),{isAnimationShow:function(){return _newArrowCheck(this,t),n.animationShow}.bind(this),startAnimation:n.start,switchAnimation:n.switch}}.bind(this),n}return _inheritsLoose(t,i),t}(Switch);export{SwitchAnimation as default};
