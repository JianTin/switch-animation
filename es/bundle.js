import _newArrowCheck from"@babel/runtime/helpers/newArrowCheck";import BezierEasing from"bezier-easing";import colorString from"color-string";import _assertThisInitialized from"@babel/runtime/helpers/assertThisInitialized";import _inheritsLoose from"@babel/runtime/helpers/inheritsLoose";var constantEasing={linear:[1,1,0,0],easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]},colorArry=["color","background-color","border-color"],transformArray=["rotate","rotateX","rotateY","rotateZ","translateX","translateY","translateZ","scaleX","scaleY","scaleZ","skewX","skewY"],Easing=function(){var e=this;this.createEasing=function(t){if(_newArrowCheck(this,e),Array.isArray(t))return BezierEasing.apply(void 0,t);t=(t=this.bulitInEasing[t])||this.bulitInEasing.linear;return BezierEasing.apply(void 0,t)}.bind(this),this.bulitInEasing=constantEasing},easing=new Easing,Store=function(){function t(){var r=this;this.createType=function(t){_newArrowCheck(this,r),this.store[t]||(this.store[t]={styleList:{},instance:null,durationObj:null,easingFn:null})}.bind(this),this.initGlobalStore=function(t){_newArrowCheck(this,r),this.globalStore=t}.bind(this),this.addStoreStyle=function(t,e,n,i,a){_newArrowCheck(this,r),this.createType(t),"box-shadow"===e?this.generateBoxShadow(t,e,n,i,a):this.colorNameArray.includes(e)?this.generateColorStyle(t,e,n,i,a):this.generateBaseStyle(t,e,n,i,a)}.bind(this),this.addStoreInstance=function(t,e){_newArrowCheck(this,r),this.createType(t),this.store[t].instance=e}.bind(this),this.addStoreDirection=function(t,e,n){_newArrowCheck(this,r),this.createType(t);var i=this.globalStore;i&&(i=i.duration,this.store[t].durationObj={positive:{startDuration:e,endDuration:n},negative:{startDuration:i-n,endDuration:i-e},direction:null,isStart:!1})}.bind(this),this.addStoreEasing=function(t,e){_newArrowCheck(this,r),this.store[t].easingFn=easing.createEasing(e)}.bind(this),this.globalStore=null,this.store={},this.colorNameArray=colorArry}var e=t.prototype;return e.generateBaseStyle=function(t,e,n,i,a){var r=this,s=Object.values(n).map(function(t){return _newArrowCheck(this,r),Number(t)}.bind(this)),n=s[0],s=s[1];this.store[t].styleList[e]={startValue:n,endValue:s,millisecond:(s-n)/a,unit:i,distance:n<s?s-n:n-s,minValDistanceZero:n<s?n:s}},e.handelArrayToStyleStore=function(t,i){var a=this,e=t.startValue,r=t.endValue,n=e.reduce(function(t,e,n){_newArrowCheck(this,a);n=r[n];return t.distance.push(e<n?n-e:e-n),t.minValDistanceZero.push(e<n?e:n),t.millisecond.push((n-e)/i),t}.bind(this),{millisecond:[],distance:[],minValDistanceZero:[]}),s=n.millisecond,t=n.distance,n=n.minValDistanceZero;return{startValue:e,endValue:r,distance:t,millisecond:s,minValDistanceZero:n}},e.handelColorParams=function(n){var i=this;return Object.keys(n).reduce(function(t,e){return _newArrowCheck(this,i),t[e]=colorString.get(n[e]).value,t}.bind(this),{startValue:[],endValue:[]})},e.generateColorStyle=function(t,e,n,i,a){var r=this.handelArrayToStyleStore(this.handelColorParams(n),a),s=r.startValue,o=r.endValue,n=r.millisecond,a=r.distance,r=r.minValDistanceZero;4===s.length&&4===o.length&&4===n.length&&this.store[t]&&(this.store[t].styleList[e]={startValue:s,endValue:o,millisecond:n,distance:a,minValDistanceZero:r,unit:i})},e.generateBoxShadow=function(t,e,n,i,h){var d=this,a=n.startValue,r=n.endValue,n=new RegExp(i,"g"),a=a.replace(n,"").split(/,(?![^\(]*\))/),s=r.replace(n,"").split(/,(?![^\(]*\))/),r=a.reduce(function(t,e,n){_newArrowCheck(this,d);var i=e.split(/ (?![^\(]*\))/).filter(Boolean),a=s[n].split(/ (?![^\(]*\))/).filter(Boolean);i&&6===i.length&&(t.inset.push(n),i.shift(),a.shift());e=i.pop(),n=a.pop();return t.color.push(this.handelColorParams({startValue:e,endValue:n})),t.shadowNumber.push({startValue:i.map(Number),endValue:a.map(Number)}),t}.bind(this),{color:[],inset:[],shadowNumber:[]}),n=r.color,a=r.inset,m=r.shadowNumber,n=n.reduce(function(t,e,n){_newArrowCheck(this,d);var i=m[n],a=this.handelArrayToStyleStore(e,h),r=a.startValue,s=a.endValue,o=a.millisecond,l=a.distance,u=a.minValDistanceZero,c=this.handelArrayToStyleStore(i,h),n=c.startValue,e=c.endValue,a=c.millisecond,i=c.distance,c=c.minValDistanceZero;return t.startValue.push({color:r,shadowNumber:n}),t.endValue.push({color:s,shadowNumber:e}),t.millisecond.push({color:o,shadowNumber:a}),t.distance.push({color:l,shadowNumber:i}),t.minValDistanceZero.push({color:u,shadowNumber:c}),t}.bind(this),{startValue:[],endValue:[],millisecond:[],distance:[],minValDistanceZero:[]});this.store[t].styleList[e]=Object.assign(n,{unit:i,inset:a})},t}(),Calculate=function(){function t(){}var e=t.prototype;return e.calculateVal=function(t,e,n,i,a){return"box-shadow"===e?this.shadowCalulate(t,n,i,a):colorArry.includes(e)?this.colorCalculate(t,n,i,a):this.baseStyleCalulate(t,n,i,a)},e.baseStyleCalulate=function(t,e,n,i){var a=t.startValue,r=t.endValue,s=t.millisecond,o=t.distance,l=t.minValDistanceZero,t=t.unit,s=s*e,e=0,e=n?a+s:r-s;return 0===o?e+t:i((e-l)/o)*o+l+t},e.colorCalculate=function(t,e,n,s){var o=this,i=t.startValue,a=t.endValue,r=t.millisecond,l=t.distance,u=t.minValDistanceZero,c=r.map(function(t){return _newArrowCheck(this,o),t*e}.bind(this));return n?i.reduce(function(t,e,n){_newArrowCheck(this,o);var i=c[n],a=l[n],r=u[n],i=e+i;return t+=0===a?i:a*s((i-r)/a)+r,3!==n&&(t+=","),3===n&&(t+=")"),t}.bind(this),"rgba("):a.reduce(function(t,e,n){_newArrowCheck(this,o);var i=c[n],a=l[n],r=u[n],i=e-i;return t+=0===a?i:a*s((i-r)/a)+r,3!==n&&(t+=","),3===n&&(t+=")"),t}.bind(this),"rgba(")},e.shadowCalulate=function(t,m,w,b){var A=this,e=t.startValue,f=t.endValue,S=t.millisecond,v=t.distance,y=t.minValDistanceZero,g=t.unit,p=t.inset;return e.reduce(function(t,e,n){var i=this;_newArrowCheck(this,A),0!==n&&(t+=","),p.includes(n)&&(t+="inset");var a=e.color,r=e.shadowNumber,s=f[n],o=s.color,l=s.shadowNumber,u=S[n],e=u.color,c=u.shadowNumber,s=v[n],u=s.color,h=s.shadowNumber,s=y[n],n=s.color,d=s.shadowNumber,n=this.colorCalculate({startValue:a,endValue:o,millisecond:e,distance:u,minValDistanceZero:n,unit:""},m,w,b);return t+=r.reduce(function(t,e,n){return _newArrowCheck(this,i),t+=" "+this.baseStyleCalulate({startValue:e,endValue:l[n],millisecond:c[n],distance:h[n],minValDistanceZero:d[n],unit:g},m,w,b)}.bind(this),"")+" "+n}.bind(this),"")},t}(),calculateInstance=new Calculate,SetStyleValue=function(){function t(){var r=this;this.setTransform=function(t,e,n,i){_newArrowCheck(this,r);var a=t.style.transform;a.includes(e)&&(a=a.replace(new RegExp(e+"\\(-*[0-9]*\\.*[0-9]*"+i+"\\)","g"),"")),t.style.transform=a+=" "+e+"("+n+")"}.bind(this),this.setBaseStyle=function(t,e,n,i){_newArrowCheck(this,r),t.style[e]=n}.bind(this),this.transformKey=transformArray}return t.prototype.set=function(t,e,n,i,a,r){var s=e.unit,r=calculateInstance.calculateVal(e,n,i,a,r);this.transformKey.includes(n)?this.setTransform(t,n,r,s):this.setBaseStyle(t,n,r,s)},t}(),setStyleInstance=new SetStyleValue,IsRunMiddleAnimation=function(){function t(){var l=this;this.runMiddleAnimation=function(t,e,n,i){_newArrowCheck(this,l);var a,r=i.store[e],s=r.instance,o=r.durationObj;s&&o&&(a=o.positive,i=o.negative,e=o.direction,r=o.isStart,n===e&&!r||(i=(a=n?a:i).startDuration,a=a.endDuration,i<t&&t<a&&(o.direction=n,r?(o.isStart=!1,s.startAnimation()):s.switchAnimation())))}.bind(this)}var e=t.prototype;return e.getDurationType=function(t){var e=this;return t.split("-").map(function(t){return _newArrowCheck(this,e),Number(t)}.bind(this))},e.middleAnimationInit=function(u,c){var h=this;Object.keys(u).forEach(function(t){_newArrowCheck(this,h);var e=this.getDurationType(t),n=e[0],i=e[1],a=u[t],r=a.onStart,s=a.onEnd,o=a.onAnimation,l=a.easing;delete a.onStart,delete a.onEnd,delete a.onAnimation,delete a.easing,new Animation({duration:i-n,element:null===(e=c.globalStore)||void 0===e?void 0:e.element,targetStyle:a,durationType:t,easing:l||(null===(l=c.globalStore)||void 0===l?void 0:l.easing),onStart:r,onEnd:s,onAnimation:o},c),c.addStoreDirection(t,n,i)}.bind(this))},t}(),isRunMiddleInstance=new IsRunMiddleAnimation,Public=function(t,e){var c=this;this.initEvent=function(t){var a=this;_newArrowCheck(this,c);var r=this.durationType,e=this.easing,s=this.storeInstance,o=t.targetStyle,n=t.middleStyle,l=t.duration;if("all"===r&&s.initGlobalStore(this),!o)return isRunMiddleInstance.middleAnimationInit(n,s);Object.keys(o).forEach(function(t){_newArrowCheck(this,a);var e,n,i=o[t];i&&(e=i.endValue,n=i.startValue,i=i.unit,s.addStoreStyle(r,t,{startValue:n,endValue:e},i,l))}.bind(this)),s.addStoreInstance(r,this),s.addStoreEasing(r,e)}.bind(this),this.endInit=function(){_newArrowCheck(this,c);var t=this.AnimationCallback.onEnd;t&&t(this.element)}.bind(this),this.reset=function(n){var i=this;_newArrowCheck(this,c);var a,r,t=this.targetStyle,e=this.durationType,s=this.duration,o=this.element,l=this.storeInstance,u=this.AnimationCallback.onAnimation;t&&(e=l.store[e],a=e.easingFn,r=e.styleList,a&&Object.keys(r).forEach(function(t){_newArrowCheck(this,i);var e=r[t];e&&(setStyleInstance.set(o,e,t,s,n,a),u&&u(o))}.bind(this)))}.bind(this);var n=t.element,i=t.targetStyle,a=t.onStart,r=t.onAnimation,s=t.onEnd,o=t.duration,l=t.durationType,u=t.easing,u=void 0===u?"linear":u;this.currentDate=0,this.startDate=0,this.endDate=0,this.element=n,this.duration=o,this.targetStyle=i||null,this.AnimationCallback={onStart:a,onAnimation:r,onEnd:s},this.durationType=l,this.isInit=!0,this.isPositive=!0,this.animationShow=!1,this.easing=u,this.storeInstance=e,this.initEvent(t)},Animation=function(n){function t(t,e){var i=this,b=n.call(this,t,e)||this;return b.startAnimation=function(){var e=this;_newArrowCheck(this,i);var t=_assertThisInitialized(b).storeInstance;b.isInit=!1,b.isPositive=!0;var n=(new Date).valueOf();b.endDate=n+b.duration,b.startDate=n,b.animationShow=!0,b.targetStyle||Object.values(t.store).forEach(function(t){return _newArrowCheck(this,e),t.durationObj.isStart=!0}.bind(this)),b.runSwitchAnimation(!0)}.bind(this),b.switchAnimation=function(){_newArrowCheck(this,i);var t=b.AnimationCallback.onStart;b.isInit?b.startAnimation():(b.animationShow=b.isPositive=!b.isPositive,b.endDate=(new Date).valueOf()+(b.currentDate-b.startDate),b.startDate=b.endDate-b.duration),b.runSwitchAnimation(b.isPositive),t&&t(b.element)}.bind(this),b.runSwitchAnimation=function(m){var w=this;_newArrowCheck(this,i),requestAnimationFrame(function(){var n=this;_newArrowCheck(this,w);var t=_assertThisInitialized(b),e=t.startDate,i=t.endDate,a=t.element,r=t.targetStyle,s=t.isPositive,o=t.durationType,l=t.storeInstance,u=b.AnimationCallback.onAnimation,t=(new Date).valueOf();if(b.currentDate=t,m===s){if(i<=t)return b.reset(!!m),b.currentDate=i,void b.endInit();var c,h,d=t-e;r?(o=l.store[o],c=o.styleList,h=o.easingFn,Object.keys(c).forEach(function(t){_newArrowCheck(this,n);var e=c[t];e&&h&&setStyleInstance.set(a,e,t,d,s,h)}.bind(this)),u&&u(a)):Object.keys(l.store).forEach(function(t){return _newArrowCheck(this,n),isRunMiddleInstance.runMiddleAnimation(d,t,m,l)}.bind(this)),b.runSwitchAnimation(m)}}.bind(this))}.bind(this),b}return _inheritsLoose(t,n),t}(Public),SwitchAnimation=function(t){var a=this;this.getInstanceEvent=function(){var t=this;_newArrowCheck(this,a);var e=this.animationInstance,n=e.startAnimation,e=e.switchAnimation,i=this;return{isAnimationShow:function(){return _newArrowCheck(this,t),i.animationInstance.animationShow}.bind(this),startAnimation:n,switchAnimation:e}}.bind(this),this.storeInstance=new Store,this.animationInstance=new Animation(t,this.storeInstance)};function wholeAnimation(t){t=Object.assign(t,{durationType:"all",targetStyle:t.animation});return delete t.animation,new SwitchAnimation(t).getInstanceEvent()}function segmentedAnimation(t){t=Object.assign(t,{durationType:"all",middleStyle:t.animation});return delete t.animation,new SwitchAnimation(t).getInstanceEvent()}export{segmentedAnimation,wholeAnimation};
